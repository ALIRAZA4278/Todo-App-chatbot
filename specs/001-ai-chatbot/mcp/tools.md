# MCP Tools Specification

**Feature Branch**: `001-ai-chatbot`
**Created**: 2026-01-16
**Status**: Draft

## Tool Overview

| Tool | Purpose | Mutates Data |
|------|---------|--------------|
| add_task | Create new todo | YES |
| list_tasks | Retrieve todos with filtering | NO |
| toggle_task_completion | Toggle complete status | YES |
| delete_task | Remove todo permanently | YES |
| search_tasks | Find todos by keyword | NO |
| get_my_user_info | Get user account info | NO |

---

## Tool: add_task

### Purpose

Creates a new todo task for the authenticated user.

### Input Schema

| Parameter | Type | Required | Constraints | Default |
|-----------|------|----------|-------------|---------|
| user_id | string | YES | Non-empty | (from JWT) |
| title | string | YES | 1-200 characters | - |
| description | string | NO | Max 1000 characters | null |
| due_date | string | NO | YYYY-MM-DD format | null |

### Output Schema

**Success:**
```json
{
  "status": "success",
  "message": "Task created successfully",
  "data": {
    "id": 47,
    "title": "Buy groceries",
    "description": "Milk, eggs, bread",
    "completed": false,
    "created_at": "2026-01-16T19:30:00Z",
    "updated_at": "2026-01-16T19:30:00Z"
  }
}
```

**Error:**
```json
{
  "status": "error",
  "message": "title is required and cannot be empty",
  "data": null
}
```

### Validation Rules

| Rule | Validation |
|------|------------|
| VR-001 | user_id MUST be non-empty string |
| VR-002 | title MUST be provided |
| VR-003 | title MUST be non-empty after trimming whitespace |
| VR-004 | title MUST be max 200 characters |
| VR-005 | description MUST be max 1000 characters if provided |
| VR-006 | due_date MUST be valid YYYY-MM-DD if provided |

### Ownership Enforcement

- Task is created with user_id from JWT (not from client)
- completed is set to false by default
- created_at and updated_at are set to current UTC time

### Error Cases

| Error | Message |
|-------|---------|
| Missing title | "title is required and cannot be empty" |
| Empty title | "title is required and cannot be empty" |
| Title too long | "title exceeds maximum length of 200 characters (got N)" |
| Description too long | "description exceeds maximum length of 1000 characters (got N)" |
| Invalid date | "due_date must be in YYYY-MM-DD format (got 'X')" |
| DB error | "Failed to create task: [safe message]" |

### Deterministic Behavior

- Same input always produces same validation result
- Task ID is auto-generated by database
- Timestamps are generated at execution time

---

## Tool: list_tasks

### Purpose

Returns a list of the user's tasks with optional filtering, sorting, and pagination.

### Input Schema

| Parameter | Type | Required | Constraints | Default |
|-----------|------|----------|-------------|---------|
| user_id | string | YES | Non-empty | (from JWT) |
| status | string | NO | "all", "pending", "completed" | "all" |
| limit | integer | NO | Positive integer | 50 |
| offset | integer | NO | Non-negative integer | 0 |
| sort_by | string | NO | "created_at", "title" | "created_at" |
| sort_order | string | NO | "asc", "desc" | "desc" |

### Output Schema

**Success:**
```json
{
  "status": "success",
  "message": "Found 8 pending tasks",
  "data": {
    "tasks": [
      {
        "id": 42,
        "title": "Call mom",
        "description": null,
        "completed": false,
        "created_at": "2026-01-16T10:00:00Z",
        "updated_at": "2026-01-16T10:00:00Z"
      }
    ],
    "total": 12,
    "returned": 8
  }
}
```

**Empty Result:**
```json
{
  "status": "success",
  "message": "Found 0 tasks",
  "data": {
    "tasks": [],
    "total": 0,
    "returned": 0
  }
}
```

### Validation Rules

| Rule | Validation |
|------|------------|
| VR-001 | user_id MUST be non-empty string |
| VR-002 | status MUST be "all", "pending", or "completed" |
| VR-003 | limit MUST be positive integer (>=1) |
| VR-004 | offset MUST be non-negative integer (>=0) |
| VR-005 | sort_by MUST be "created_at" or "title" |
| VR-006 | sort_order MUST be "asc" or "desc" |

### Ownership Enforcement

- Query ALWAYS includes WHERE user_id = :user_id
- User cannot see other users' tasks

### Error Cases

| Error | Message |
|-------|---------|
| Invalid status | "status must be 'all', 'pending', or 'completed' (got 'X')" |
| Invalid limit | "limit must be at least 1 (got N)" |
| Invalid offset | "offset must be non-negative (got N)" |
| Invalid sort_by | "sort_by must be 'created_at' or 'title' (got 'X')" |
| Invalid sort_order | "sort_order must be 'asc' or 'desc' (got 'X')" |

### Deterministic Behavior

- Same filters always return same results (given same DB state)
- Sorting is deterministic (secondary sort by id for ties)

---

## Tool: toggle_task_completion

### Purpose

Toggles the completion status of a specific task (complete â†” incomplete).

### Input Schema

| Parameter | Type | Required | Constraints | Default |
|-----------|------|----------|-------------|---------|
| user_id | string | YES | Non-empty | (from JWT) |
| task_id | integer | YES | Positive integer | - |

### Output Schema

**Success:**
```json
{
  "status": "success",
  "message": "Task marked as completed",
  "data": {
    "task_id": 47,
    "title": "Buy groceries",
    "completed": true,
    "updated_at": "2026-01-16T19:45:00Z"
  }
}
```

### Validation Rules

| Rule | Validation |
|------|------------|
| VR-001 | user_id MUST be non-empty string |
| VR-002 | task_id MUST be positive integer |

### Ownership Enforcement

- Query includes WHERE id = :task_id AND user_id = :user_id
- Returns "not found" if task doesn't exist OR belongs to another user
- NEVER reveals whether task exists for other users

### Error Cases

| Error | Message |
|-------|---------|
| Invalid task_id | "task_id must be a positive integer (got N)" |
| Task not found | "Task not found with id N" |
| DB error | "Failed to toggle task completion: [safe message]" |

### Deterministic Behavior

- Toggle is idempotent within same DB state
- Always flips from current state
- Message reflects new state ("completed" or "pending")

---

## Tool: delete_task

### Purpose

Permanently deletes a task.

### Input Schema

| Parameter | Type | Required | Constraints | Default |
|-----------|------|----------|-------------|---------|
| user_id | string | YES | Non-empty | (from JWT) |
| task_id | integer | YES | Positive integer | - |

### Output Schema

**Success:**
```json
{
  "status": "success",
  "message": "Task 'Buy groceries' has been deleted",
  "data": {
    "deleted_task_id": 47,
    "deleted_title": "Buy groceries"
  }
}
```

### Validation Rules

| Rule | Validation |
|------|------------|
| VR-001 | user_id MUST be non-empty string |
| VR-002 | task_id MUST be positive integer |

### Ownership Enforcement

- Query includes WHERE id = :task_id AND user_id = :user_id
- Returns "not found" if task doesn't exist OR belongs to another user
- NEVER reveals whether task exists for other users

### Error Cases

| Error | Message |
|-------|---------|
| Invalid task_id | "task_id must be a positive integer (got N)" |
| Task not found | "Task not found with id N" |
| DB error | "Failed to delete task: [safe message]" |

### Deterministic Behavior

- Delete is idempotent (deleting non-existent task returns "not found")
- Returns deleted task's title for confirmation message

---

## Tool: search_tasks

### Purpose

Searches user's tasks by keyword in title and description.

### Input Schema

| Parameter | Type | Required | Constraints | Default |
|-----------|------|----------|-------------|---------|
| user_id | string | YES | Non-empty | (from JWT) |
| keyword | string | YES | Non-empty | - |
| status | string | NO | "all", "pending", "completed" | "all" |

### Output Schema

**Success:**
```json
{
  "status": "success",
  "message": "Found 3 tasks matching 'groceries'",
  "data": {
    "tasks": [
      {
        "id": 42,
        "title": "Buy groceries",
        "description": "Milk, eggs, bread",
        "completed": false,
        "created_at": "2026-01-16T10:00:00Z",
        "updated_at": "2026-01-16T10:00:00Z"
      }
    ],
    "search_term": "groceries",
    "total": 3
  }
}
```

### Validation Rules

| Rule | Validation |
|------|------------|
| VR-001 | user_id MUST be non-empty string |
| VR-002 | keyword MUST be non-empty string |
| VR-003 | status MUST be "all", "pending", or "completed" |

### Ownership Enforcement

- Query ALWAYS includes WHERE user_id = :user_id
- User cannot search other users' tasks

### Search Behavior

- Case-insensitive search
- Searches in both title AND description
- Uses SQL ILIKE with wildcards: %keyword%
- Results ordered by created_at DESC

### Error Cases

| Error | Message |
|-------|---------|
| Missing keyword | "keyword is required and cannot be empty" |
| Invalid status | "status must be 'all', 'pending', or 'completed' (got 'X')" |

### Deterministic Behavior

- Same keyword always returns same results (given same DB state)
- Empty result returns success with empty array

---

## Tool: get_my_user_info

### Purpose

Returns basic information about the currently authenticated user.

### Input Schema

| Parameter | Type | Required | Constraints | Default |
|-----------|------|----------|-------------|---------|
| user_id | string | YES | Non-empty | (from JWT) |

### Output Schema

**Success:**
```json
{
  "status": "success",
  "message": "Here is your account information",
  "data": {
    "id": "user_abc123",
    "email": "ali@example.com",
    "name": "ALI",
    "created_at": "2024-11-05T14:20:00Z"
  }
}
```

### Validation Rules

| Rule | Validation |
|------|------------|
| VR-001 | user_id MUST be non-empty string |

### Security Rules

- NEVER returns password or hashed password
- NEVER returns authentication tokens
- NEVER returns session data
- Only returns safe, non-sensitive fields

### Error Cases

| Error | Message |
|-------|---------|
| User not found | "User not found" |
| DB error | "Failed to get user info: [safe message]" |

### Deterministic Behavior

- Same user_id always returns same user data
- created_at is immutable after user creation
